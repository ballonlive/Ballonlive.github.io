<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بث مباشر - كل القنوات</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .channel-card {
            display: flex; align-items: center; padding: 12px; background-color: #374151;
            border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease;
            border: 2px solid transparent;
        }
        .channel-card:hover { background-color: #4b5563; transform: scale(1.03); }
        .channel-card.active { background-color: #1e3a8a; border-color: #3b82f6; font-weight: bold; }
        .aspect-w-16 { position: relative; padding-bottom: 56.25%; background-color: #000; }
        .aspect-h-9 > iframe { position: absolute; top: 0; right: 0; width: 100%; height: 100%; border: none; }
        .ad-placeholder { border: 2px dashed #4a5563; }
        #loading-message { text-align: center; padding: 2rem; }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-4">

        <header class="text-center my-6">
            <h1 class="text-4xl font-bold">بث مباشر للمباريات</h1>
            <p class="text-gray-400 mt-2">اختر القناة التي تريد مشاهدتها من القائمة أدناه</p>
        </header>

        <div class="ad-placeholder my-4 bg-gray-700 h-24 flex items-center justify-center">
            <span class="text-gray-400">مكان الإعلان (728x90)</span>
        </div>

        <main class="grid grid-cols-1 md:grid-cols-4 gap-6">

            <div class="md:col-span-3 bg-black rounded-lg shadow-lg">
                <div class="aspect-w-16 aspect-h-9">
                    <iframe id="video-iframe" src="about:blank" allowfullscreen allow="autoplay; encrypted-media"></iframe>
                </div>
                <div id="current-channel-name" class="p-4 text-xl font-semibold">
                    الرجاء اختيار قناة للبدء
                </div>
            </div>

            <div class="md:col-span-1 bg-gray-800 p-4 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold mb-4 border-b-2 border-gray-700 pb-2">قائمة القنوات</h2>
                
                <!-- سيتم ملء القائمة هنا تلقائياً بواسطة JavaScript -->
                <div id="channel-list" class="space-y-2 max-h-screen overflow-y-auto">
                    <p id="loading-message">جاري تحميل قائمة القنوات...</p>
                </div>

                <div class="ad-placeholder mt-6 bg-gray-700 h-64 flex items-center justify-center">
                    <span class="text-gray-400">مكان الإعلان الجانبي</span>
                </div>
            </div>
        </main>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- ==================== JavaScript النهائي والديناميكي ==================== -->
    <script>
    $(document).ready(function() {
        const playerIframe = $('#video-iframe');
        const currentChannelName = $('#current-channel-name');
        const channelListDiv = $('#channel-list');
        const loadingMessage = $('#loading-message');

        // اسم الملف الذي يحتوي على قائمة التشغيل الكاملة
        const playlistUrl = "playlist.m3u"; 

        // جلب وتحليل قائمة القنوات من الملف المحلي
        $.get(playlistUrl, function(data) {
            loadingMessage.hide(); // إخفاء رسالة التحميل
            const lines = data.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                // البحث عن السطر الذي يحتوي على معلومات القناة
                if (lines[i].startsWith('#EXTINF:')) {
                    const infoLine = lines[i];
                    const streamUrl = lines[i + 1] ? lines[i + 1].trim() : null;

                    if (streamUrl && streamUrl.startsWith('http')) {
                        // استخراج اسم القناة (الجزء الأخير بعد الفاصلة)
                        let name = infoLine.split(',').pop();

                        // استخراج رابط الشعار باستخدام regular expression
                        let logoMatch = infoLine.match(/tvg-logo="([^"]+)"/);
                        // إذا لم يتم العثور على شعار، نستخدم شعاراً افتراضياً
                        let logoUrl = logoMatch ? logoMatch[1] : 'https://via.placeholder.com/40/374151/FFFFFF?text=TV';

                        // إنشاء عنصر القناة وإضافته إلى القائمة
                        const channelHtml = `
                            <div class="channel-card" data-stream-url="${streamUrl}" data-channel-name="${name}">
                                <img src="${logoUrl}" alt="" class="w-10 h-10 ml-3 bg-gray-600 rounded" onerror="this.src='https://via.placeholder.com/40/374151/FFFFFF?text=TV';">
                                <span>${name}</span>
                            </div>`;
                        channelListDiv.append(channelHtml);
                    }
                }
            }

            // تشغيل القناة الأولى تلقائياً بعد بناء القائمة
            setTimeout(() => {
                $('#channel-list .channel-card').first().trigger('click');
            }, 500);

        }).fail(function() {
            loadingMessage.text('فشل تحميل ملف playlist.m3u. تأكد من وجوده في نفس المجلد.');
        });

        // وظيفة النقر على أي قناة (باستخدام event delegation)
        channelListDiv.on('click', '.channel-card', function() {
            const streamUrl = $(this).data('stream-url');
            const channelName = $(this).data('channel-name');

            if (streamUrl) {
                const newIframeSrc = `player.html?stream=${encodeURIComponent(streamUrl)}`;
                playerIframe.attr('src', newIframeSrc);
                currentChannelName.text(`أنت تشاهد الآن: ${channelName}`);
                
                $('.channel-card').removeClass('active');
                $(this).addClass('active');
            }
        });
    });
    </script>
    <!-- ======================================================================= -->
</body>
</html>
